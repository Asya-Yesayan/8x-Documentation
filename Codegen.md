
# 4x-ական նկարագրությունների տեղափոխման մասնակի ավտոմատացում

`Codegen` գործիքը նախատեսված է 4x-ում նկարագրված տվյալների աղբյուրների և փաստաթղթերի նկարագրությունների 8x համակարգ տեղափոխումը մասնակի ավտոմատացնելու համար։ Այն հնարավորություն է տալիս 8x տեղափոխել համակարգային նկարագրությունների միայն նկարագրման հատվածը (Definition), սկրիպտային բաժնի տեղափոխումը ավտոմատացված չէ։

## Նախապատրաստական քայլեր

 - Տեղադրել VS-ը։
 - Աշխատացնել  …\AS-8X\bin թղթապանակի ArmSoft.AS8X.CodeGen.bat Ֆայլը, որը ռեգիստրացնում է CodeGen գործիքի աշխատանքի համար անհրաժեշտ dll-ները։
 - Այն պրոյեկտում, որտեղ կիրառվելու է Codegen-ը,անհրաժեշտ է ավելացնել CodeGen.xml անունով ֆայլ՝ գրելով xml-ի տարբերակի համարը, կոդավորման տեսակը և  տեղափոխվող սկրիպտերի թղթապանակի ճանապարհը։

Օրինակ՝

```xml
<?xml version="1.0" encoding="utf-8" ?>
<Configuration>
  <ScriptsPath>..\..\Scripts</ScriptsPath>
</Configuration>
```
- Codegen-ը աշխատում է .tt ընդլայնմամբ ֆայլերի միջոցով և աշխատանքի արդյունքում գեներացնում է .cs ընդլայնմամբ ֆայլ։


## Նկարագրությունը տեղափոխելու համար անհրաժեշտ ընդհանուր քայլեր

 - Ստեղծել .tt ընդլայնմամբ ֆայլ հետևյալ ձևով՝ Add -> New Item -> Text Template։ Նախընտրելի  է ֆայլի անունը դնել հետևյալ ֆորմատի՝ GeneratedDSClassName.Codegen.tt, որպեսզի ապահովենք նկարագրության սկրպտային բաժինը և նկարագրման բաժինը նկարագրող դասերի [ներդրվածությունը](https://learn.microsoft.com/en-us/visualstudio/ide/file-nesting-solution-explorer?view=vs-2022)։

 - Հեռացնել .tt ընդլայնմամբ ֆայլի հետ միասին ստեղծվող .txt ընդլայնմամբ ֆայլը ։
 - Ստեղծված ֆայլի հատկությունների Custom tool դաշտի արժեքը դնել TextTemplatingFileGenerator հետևյալ ձևով՝ right click on file -> Properties -> Custom tool = TextTemplatingFileGenerator:
 - Մաքրել ֆայլի default պարունակությունը և ավելացնել հետևյալ տեքստը՝
  
```txt
<#@ template debug="false" hostspecific="true" language="C#" #>
<#@ assembly name="ArmSoft.AS8X.CodeGen" #>
<#@ import namespace="ArmSoft.AS8X.CodeGen" #>
<#@ output extension=".cs" #>
```

## Տվյալների աղբյուրի նկարագրությունը տեղափոխելու համար անհրաժեշտ քայլեր

Տվյալների աղբյուրի նկարագրությունը պարունակող c# դասը գեներացնելու համար անհրաժեշտ է վերևում նշված ընդհանուր քայլերից հետո .tt ընդլայնմամբ ֆայլում ավելացնել տվյալների աղբյուրի 4x-ական նկարագրությունը 8x-ականի parse անող մեթոդը կանչը՝ փոխանցելով անհրաժեշտ արգումենտները ու մեթոդի արդյունքը փոխանցել code անունով string տիպի փոփոխականի։

DSParser static դասի Parse մեթոդը ունի հետևյալ շարահյուսությունը՝

```c#
        public static string Parse(string configFilePath, string filename, string dsName, string namespaceName,
                                   string className = "", bool generatePublicConstructor = false, string conditionalCompilationList = "")
```
Օրինակ՝ 
```c#
<#
    string code = DSParser.Parse(this.Host.ResolvePath("..\\..\\..\\CodeGen.xml"), "SOURCE\\ACCBAL\\ACCBAL.AS", "AccCli", "Bank.General.AccBal.DS","AccountsAndClients");
#>
<#= code #>
```

Parse մեթոդի պարամետրերն են՝

| Անվանում                  | Տեսակ  | Նկարագրություն                                                                                                                                                                                                                     | Լռությամբ արժեք                                      |
|---------------------------|:------:|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| configFilePath            | string | CodeGen.xml-ի ճանապարհը                                                                                                                                                                                                            | Չունի, արժեքը պարտադիր է լրացնել                    |
| filename                  | string | Տվյալների աղբյուրը պարունակող .as ընդլայնմամբ ֆայլի ճանապարհը                                                                                                                                                               | Չունի, արժեքը պարտադիր է լրացնել                    |
| dsName                    | string | Տվյալների աղբյուրի ներքին անվանումը                                                                                                                                                                                                | Չունի, արժեքը պարտադիր է լրացնել                    |
| namespaceName             | string | Գեներացվող դասի namespace-ը                                                                                                                                                                                                       | Չունի, արժեքը պարտադիր է լրացնել                    |
| className                 | string | Գեներացվող դասի անվանումը։ Չլրացնելու դեպքում համընկնելու է տվյալների աղբյուրի ներքին անվանման հետ՝ dsName։                                                                                                | string.Empty                                        |
| generatePublicConstructor | bool   | Գեներացվող  դասի կոնստրուկտորը լինի public թե private հասանելիությամբ։ Չլրացնելու դեպքում գեներացվում է private հասանելիությամբ կոնստրուկտոր                                                                                        | false                                               |
| conditionalCompilationList| string | Որոշ տվյալների աղբյուրներ ընդհանուր են մի քանի համակարգերի համար և տարբերվում են միայն գտնվելու տեղով՝ namespace-ով։ Որպեսզի նույն դասը 2 տեղ չգրենք, տեղադրում ենք Tfs-ում ընդհանուր հասանելիության թղթապանակում և լինկով միացնում անհրաժեշտ պրոյեկտներում։ Իսկ conditionalCompilationList-ում գրում ենք այն պրոյեկտների անվանումները, որոնց լինկով միացրել ենք դասը։ Պրոյեկտների անունները  անհրաժեշտ է իրարից անջատել ստորակետերով։ | string.Empty                                        |


## Փաստաթղթի նկարագրությունը տեղափոխելու համար անհրաժեշտ քայլեր

4x համակարգում գոյություն ունի փաստաթուղթը նկարագրող մեկ դաս, որը ծառայում է և՛ կլիենտական և՛ սերվիսային նպատակներով:
8x-համակարգում սերվիսային և կլիենտական ֆունկցիոնալությունները առանձնացված են և յուրաքանչյուրի համար դաս է սահմանված։

### Սերվիսային նկարագրության տեղափոխում

Փաստաթղթի սերվիսային նկարագրությունը պարունակող c# դասը գեներացնելու համար անհրաժեշտ է վերևում նշված ընդհանուր քայլերից հետո .tt ընդլայնմամբ ֆայլում 
 ավելացնել փաստաթղթի  4x-ական նկարագրությունը 8x-ականի parse անող մեթոդը կանչը՝ փոխանցելով անհրաժեշտ արգումենտները ու մեթոդի արդյունքը փոխանցել code անունով string տիպի փոփոխականի։

DocParser static դասի Parse մեթոդը ունի հետևյալ շարահյուսությունը՝
```c#
        public static string Parse(string configFilePath, string filename, string docType, string namespaceName, string className = "",
                                   string conditionalCompilationList = "", DocGeneratorOptions options = null, string parentClass = "",
                                   bool generateFieldAccessor = false, bool uppercaseAll = false)
```
Օրինակ՝ 
``` c#
<#
string code = DocParser.Parse(configFilePath:this.Host.ResolvePath("..\\..\\..\\..\\..\\Enterprise\\AS-8X\\ArmSoft.AS8X.Enterprise\\CodeGen.xml"),
                              filename:"\\OLAP\\EnterpriseCommon\\OLPGRP.as",
                              docType:"OLPGRP",
                              namespaceName:"Doc.OLAP",
                              conditionalCompilationList:"Enterprise, Wages",
                              generateFieldAccessor:true,
                              className:"AtmIndGrp");
#>
<#= code #>
```

Parse մեթոդի պարամետրերն են՝

| Անվանում                  | Տեսակ             | Նկարագրություն                                                                                                                                                                                                                   | Լռությամբ արժեք                                      |
|---------------------------|:-----------------:|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| configFilePath            | string            | CodeGen.xml ճանապարհը                                                                                                                                                                                                            | Չունի, արժեքը պարտադիր է լրացնել                    |
| filename                  | string            | Փաստաթուղթը պարունակող .as ընդլայնմամբ ֆայլի ճանապարհը                                                                                                                                                                    | Չունի, արժեքը պարտադիր է լրացնել                    |
| docType                   | string            | Փաստաթղթի տեսակը                                                                                                                                                                                                                | Չունի, արժեքը պարտադիր է լրացնել                    |
| namespaceName             | string            | Գեներացվող դասի namespace-ը                                                                                                                                                                                                     | Չունի, արժեքը պարտադիր է լրացնել                    |
| className                 | string            | Գեներացվող դասի անվանումը։ Չլրացնելու դեպքում համընկնելու է փաստաթղթի տեսակի  անվանման հետ՝ docType                                                                                                    | string.Empty                                        |
| conditionalCompilationList| string            | Որոշ տվյալների աղբյուրներ ընդհանուր են մի քանի համակարգերի համար և տարբերվում են միայն գտնվելու տեղով՝ namespace-ով։ Որպեսզի նույն դասը 2 տեղ չգրենք, տեղադրում ենք Tfs-ում ընդհանուր հասանելիության թղթապանակում և լինկով միացնում անհրաժեշտ պրոյեկտներում։ Իսկ conditionalCompilationList-ում գրում ենք այն պրոյեկտների անվանումները, որոնց լինկով միացրել ենք դասը։ Պրոյեկտների անունները  անհրաժեշտ է իրարից անջատել ստորակետերով։ | string.Empty                                        |
| options                   | DocGeneratorOptions| Այս հատկությունը հնարավորություն է տալիս վերանվանել փաստաթղթի ռեկվիզիտների ու գրիդի սյուների անունները։                                                                                                                                | null                                                |
| parentClass               | string            | Գեներացվող փաստաթուղթի ծնող դասը, որը պետք է ժառանգ լինի Document դասից։ Չլրացնելու դեպքում ծնող դաս է հանդիսանալու Document դասը։                                                                                | string.Empty                                        |
| generateFieldAccessor     | bool              | Ցույց է տալիս թե գեներացվող փաստաթղթի դաշտերը լինեն c#-ի ներդրված տիպերի թե DocumentFieldAccessor<T> տիպի, որտեղ որպես T դրվում է դաշտի համակարգային տիպին համապատասխան c#-ի ներդրված տիպը։                                   | false                                               |
| uppercaseAll              | bool              | Ցույց է տալիս թե գեներացվող դասի բոլոր էլեմենտների(ռեկվիզիտ, մեմո, աղյուսակի սյուն, …) անունները լինեն մեծատառ թե ոչ։ Չլրացնելու դեպքում էլեմենտները անունները ունենում են 4x-ին համարժեք անուններ։                                | false                                               |

### .as ընդլայմամբ ֆայլի մեջ գտնվող բոլոր փաստաթղթերի սերվիսային նկարագրությունների տեղափոխում

.as ֆայլում գնտվող բոլոր փաստաթղթերի սերվիսային նկարագրությունների  c#-ական դասերը գեներացնելու համար անհրաժեշտ է վերևում նշված ընդհանուր քայլերից հետո .tt ընդլայնմամբ ֆայլում  ավելացնել փաստաթղթերի  4x-ական նկարագրությունները 8x-ականի parse անող մեթոդի կանչը՝ փոխանցելով անհրաժեշտ արգումենտները ու մեթոդի արդյունքը փոխանցել code անունով string տիպի փոփոխականի։

DocParser static դասի ParseAll մեթոդը ունի հետևյալ շարահյուսությունը՝

```c#
        public static string ParseAll(string configFilePath, string filename, string namespaceName,
                                      string conditionalCompilationList = "", Dictionary<string, DocGeneratorOptions> options = null,
                                      bool generateFieldAccessor = false, bool uppercaseAll = false)
```


Օրինակ՝ 
``` c#
<#    
    string code = DocParser.ParseAll(configFilePath : this.Host.ResolvePath("..\\..\\..\\..\\..\\Enterprise\\AS-8X\\ArmSoft.AS8X.Enterprise\\CodeGen.xml"),
	                                    filename : "\\SYSTEM\\EnterpriseCommon\\Approvals\\ApprStages.as",
		                                namespaceName : "Client.Documents.System.ApprCompoundStage",
                                        conditionalCompilationList:"EnterpriseClient, WagesClient",
		                                className : "ApprCompoundStage");

   
#>
<#= code #>
```

ParseAll մեթոդի պարամետրերն են՝


| Անվանում                  | Տեսակ                                | Նկարագրություն                                                                                                                                                                                                                   | Լռությամբ արժեք                                      |
|---------------------------|:------------------------------------:|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| configFilePath            | string                               | CodeGen.xml ճանապարհը                                                                                                                                                                                                            | Չունի, արժեքը պարտադիր է լրացնել                    |
| filename                  | string                               | Փաստաթուղթը պարունակող .as ընդլայնմամբ ֆայլի ճանապարհը                                                                                                                                                                    | Չունի, արժեքը պարտադիր է լրացնել                    |
| namespaceName             | string                               | Գեներացվող դասի namespace-ը                                                                                                                                                                                                     | Չունի, արժեքը պարտադիր է լրացնել                    |
| conditionalCompilationList| string                               | Որոշ փաստաթղթեր ընդհանուր են մի քանի համակարգերի համար և տարբերվում են միայն գտնվելու տեղով՝ namespace-ով։ Որպեսզի նույն դասը 2 տեղ չգրենք, տեղադրում ենք Tfs-ում ընդհանուր հասանելիության թղթապանակում և լինկով միացնում անհրաժեշտ պրոյեկտներում։ Իսկ conditionalCompilationList-ում գրում ենք այն պրոյեկտների անվանումները, որոնց լինկով միացրել ենք դասը։ Պրոյեկտների անունները  անհրաժեշտ է իրարից անջատել ստորակետերով։ | string.Empty                                        |
| options                   | DocGeneratorOptions| Այս հատկությունը հնարավորություն է տալիս վերանվանել փաստաթղթի ռեկվիզիտների ու գրիդի սյուների անունները։                                                                                                                                | null                                                |
| generateFieldAccessor     | bool                                 | Ցույց է տալիս թե գեներացվող փաստաթղթերի դաշտերը լինեն c#-ի ներդրված տիպերի թե DocumentFieldAccessor<T> տիպի, որտեղ որպես T դրվում է դաշտի համակարգային տիպին համապատասխան c#-ի ներդրված տիպը։                                   | false                                               |
| uppercaseAll              | bool                                 | Ցույց է տալիս թե գեներացվող դասերի բոլոր էլեմենտների(ռեկվիզիտ, մեմո, աղյուսակի սյուն, …) անունները լինեն մեծատառ թե ոչ։ Չլրացնելու դեպքում էլեմենտները անունները ունենում են 4x-ին համարժեք անուններ։                                | false                                               |


Ի տարբերություն DocParser դասի Parse մեթոդի, այս մեթոդում չենք կարող նշել գեներացվող դասերի անունները, գեներացվող դասերի ունենալու են փաստաթղթի 4x-ական անունը: Նաև չենք կարող նշել այն դասը, որից ժառանգելու են գեներացվող դասերը, բոլորը ժառանգվելու են Document դասից։

# Կլիենտական նկարագրության տեղափոխում

Փաստաթղթի կլիենտական նկարագրությունը պարունակող c# դասը գեներացնելու համար անհրաժեշտ է վերևում նշված ընդհանուր քայլերից հետո .tt ընդլայնմամբ ֆայլում 
 ավելացնել փաստաթղթի 4x-ական նկարագրությունը 8x-ական parse անող մեթոդը կանչը՝ փոխանցելով անհրաժեշտ արգումենտները ու մեթոդի արդյունքը փոխանցել code անունով string տիպի փոփոխականի։

DocParser static դասի ParseClient մեթոդը ունի հետևյալ շարահյուսությունը՝

        public static string ParseClient(string configFilePath, string filename, string docType, string namespaceName, string className = "",
                                         string conditionalCompilationList = "", DocGeneratorOptions options = null, string parentClass = "")


Օրինակ՝ 
<#    
    string code = DocParser.ParseClient(configFilePath : this.Host.ResolvePath("..\\..\\..\\..\\..\\Enterprise\\AS-8X\\ArmSoft.AS8X.Enterprise\\CodeGen.xml"),
	                                    filename : "\\SYSTEM\\EnterpriseCommon\\Approvals\\ApprStages.as",
		                                docType : "AppStCmp",
		                                namespaceName : "Client.Documents.System.ApprCompoundStage",
                                        conditionalCompilationList:"EnterpriseClient, WagesClient",
		                                className : "ApprCompoundStage");

   
#>
<#= code #>


ParseClient մեթոդի պարամետրերն են՝

| Անվանում                  | Տեսակ             | Նկարագրություն                                                                                                                                                                                                                   | Լռությամբ արժեք                                      |
|---------------------------|:-----------------:|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| configFilePath            | string            | CodeGen.xml ճանապարհը                                                                                                                                                                                                            | Չունի, արժեքը պարտադիր է լրացնել                    |
| filename                  | string            | Փաստաթուղթը պարունակող .as ընդլայնմամբ ֆայլի ճանապարհը                                                                                                                                                                    | Չունի, արժեքը պարտադիր է լրացնել                    |
| docType                   | string            | Փաստաթղթի տեսակը                                                                                                                                                                                                                | Չունի, արժեքը պարտադիր է լրացնել                    |
| namespaceName             | string            | Գեներացվող դասի namespace-ը                                                                                                                                                                                                     | Չունի, արժեքը պարտադիր է լրացնել                    |
| className                 | string            | Գեներացվող դասի անվանումը։ Չլրացնելու դեպքում համընկնելու է փաստաթղթի տեսակի անվանման հետ՝ docType                                                                                                    | string.Empty                                        |
| conditionalCompilationList| string            | Որոշ փաստաթղթեր ընդհանուր են մի քանի համակարգերի համար և տարբերվում են միայն գտնվելու տեղով՝ namespace-ով։ Որպեսզի նույն դասը 2 տեղ չգրենք, տեղադրում ենք Tfs-ում ընդհանուր հասանելիության թղթապանակում և լինկով միացնում անհրաժեշտ պրոյեկտներում։ Իսկ conditionalCompilationList-ում գրում ենք այն պրոյեկտների անվանումները, որոնց լինկով միացրել ենք դասը։ Պրոյեկտների անունները անհրաժեշտ է իրարից անջատել ստորակետերով։ | string.Empty                                        |
| options                   | DocGeneratorOptions| Այս հատկությունը հնարավորություն է տալիս վերանվանել փաստաթղթի ռեկվիզիտների ու գրիդի սյուների անունները։                                                                                                                                | null                                                |
| parentClass               | string            | Գեներացվող փաստաթուղթի ծնող դասը, որը պետք է ժառանգ լինի Document դասից։ Չլրացնելու դեպքում ծնող դաս է հանդիսանալու Document դասը։                                                                                | string.Empty                                        |

### .as ընդլայմամբ ֆայլի մեջ գտնվող բոլոր փաստաթղթերի կլիենտական նկարագրությունների տեղափոխում

.as ֆայլում գնտվող բոլոր փաստաթղթերի կլիենտական նկարագրությունների  c#-ական դասերը գեներացնելու համար անհրաժեշտ է վերևում նշված ընդհանուր քայլերից հետո .tt ընդլայնմամբ ֆայլում  ավելացնել փաստաթղթի 4x-ական նկարագրությունը 8x-ականի parse անող մեթոդը կանչը՝ փոխանցելով անհրաժեշտ արգումենտները ու մեթոդի արդյունքը փոխանցել code անունով string տիպի փոփոխականի։

DocParser static դասի ParseClientAllմեթոդը ունի հետևյալ շարահյուսությունը՝

        public static string ParseClientAll(string configFilePath, string filename, string namespaceName,
                                            string conditionalCompilationList = "", Dictionary<string, DocGeneratorOptions> options = null)




Օրինակ՝ 
```c#
<#    
    string code = DocParser.ParseClientAll(configFilePath : this.Host.ResolvePath("..\\..\\..\\..\\..\\Enterprise\\AS-8X\\ArmSoft.AS8X.Enterprise\\CodeGen.xml"),
	                                    filename : "\\SYSTEM\\EnterpriseCommon\\Approvals\\ApprStages.as",
		                                namespaceName : "Client.Documents.System.ApprCompoundStage",
                                        conditionalCompilationList:"EnterpriseClient, WagesClient",
		                                className : "ApprCompoundStage");

   
#>
<#= code #>
```

ParseClientAll մեթոդի պարամետրերն են՝

| Անվանում                  | Տեսակ                                | Նկարագրություն                                                                                                                                                                                                                   | Լռությամբ արժեք                                      |
|---------------------------|:------------------------------------:|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| configFilePath            | string                               | CodeGen.xml ճանապարհը                                                                                                                                                                                                            | Չունի, արժեքը պարտադիր է լրացնել                    |
| filename                  | string                               | Փաստաթուղթը պարունակող .as ընդլայնմամբ ֆայլի ճանապարհը                                                                                                                                                                    | Չունի, արժեքը պարտադիր է լրացնել                    |
| namespaceName             | string                               | Գեներացվող դասի namespace-ը                                                                                                                                                                                                     | Չունի, արժեքը պարտադիր է լրացնել                    |
| conditionalCompilationList| string                               | Որոշ փաստաթղթեր ընդհանուր են մի քանի համակարգերի համար և տարբերվում են միայն գտնվելու տեղով՝ namespace-ով։ Որպեսզի նույն դասը 2 տեղ չգրենք, տեղադրում ենք Tfs-ում ընդհանուր հասանելիության թղթապանակում և լինկով միացնում անհրաժեշտ պրոյեկտներում։ Իսկ conditionalCompilationList-ում գրում ենք այն պրոյեկտների անվանումները, որոնց լինկով միացրել ենք դասը։ Պրոյեկտների անունները անհրաժեշտ է իրարից անջատել ստորակետերով։ | string.Empty                                        |
| options                   | DocGeneratorOptions| Այս հատկությունը հնարավորություն է տալիս վերանվանել փաստաթղթի ռեկվիզիտների ու գրիդի սյուների անունները։                                                                                                                                | null                                                |


