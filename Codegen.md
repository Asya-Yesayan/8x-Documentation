
# 4x-ական նկարագրությունների տեղափոխման ավտոմատացում

`Codegen`-ի գործիքը նախատեսված է 4x-ում նկարագրված տվյալների աղբյուրների ու փաստաթղթերի նկարագրությունների 8x համակարգ տեղափոխումը ավտոմատացնելու նպատակով։

## Նախապատրաստական քայլեր`

 - Տեղադրել VS 2022-ը իր բոլոր թարմացումներով։
 - Աշխատացնել  …\AS-8X\bin թղթապանակի ArmSoft.AS8X.CodeGen.bat Ֆայլը, որը ռեգիստրացնում է CodeGen-ի համար անհրաժեշտ dll-ները։
 - Այն պրոյեկտում, որտեղ ավելացվելու է .tt ընդլայնմամբ ֆայլը, անհրաժեշտ է ավելացնել CodeGen.xml անունով ֆայլ, որտեղ անհրաժեշտ է ավելացնել xml-ի version-ը, կոդավորման տեսակը ու  տեղափոխվող սկրիպտերի base թղթապանակը։

Լրացման օրինակ՝

```xml
<?xml version="1.0" encoding="utf-8" ?>
<Configuration>
  <ScriptsPath>..\..\Scripts</ScriptsPath>
</Configuration>
```

## Նկարագրությունը տեղափոխելու համար անհրաժեշտ ընդհանուր քայլեր

 - Ստեղծել .tt ընդլայնմամբ ֆայլ։ Դա կարելի է անել հետևյալ ձևով Add -> New Item -> Text Template։ Նախընտրելի  է ֆայլի անունը դնել հետևյալ ձևի GeneratedDSClassName.Codegen.tt, որպեսզի պարզ դառնա որ այն գեներացվել է CodeGen գործիքով։
 - .tt ընդլայնմամբ ֆայլի հետ միասին ստեղծվում է նույն անունով .txt ընդլայնմամբ ֆայլ։ Այն անհրաժեշտ է հեռացնել։
 - Ստեղծված ֆայլի հատկությունների Custom tool դաշտի արժեքը դնել TextTemplatingFileGenerator. right click on file -> Properties -> Custom tool = TextTemplatingFileGenerator:
 - Մաքրել ֆայլի default պարունակությունը։
 - ֆայլում ավելացնել հետևյալ տեքստը՝
   
```xml
<#@ template debug="false" hostspecific="true" language="C#" #>
<#@ assembly name="ArmSoft.AS8X.CodeGen" #>
<#@ import namespace="ArmSoft.AS8X.CodeGen" #>
<#@ output extension=".cs" #>
```

 Այս տեքստի միջոցով մենք նշում ենք .tt ընդլայնմամբ ֆայլի կարգավորումները`
- <#@ template debug="false" - նշվում է .tt ընդլայնմամբ ֆայլը ունի debug ռեժիմ թե ոչ
- hostspecific="true" - Ցույց է տալիս որ ֆայլի վարքագիծը կարող է կախված լինել hosting enviroment- ից
- language="C#" - ֆայլի մեջ գրվող կոդի լեզուն։ Այս դեպքում c#-ն է։
- <#@ assembly name="ArmSoft.AS8X.CodeGen" #> - նշում ենք այն արտաքին assembly-ին(assembly-ին reference-ով կպցված է .tt ընդլայնմամբ ֆայլի գտնվելու assembly-ին), որի ֆունկցիոնալությունը մեզ անհրաժեշտ է ֆայլում։
- <#@ import namespace="ArmSoft.AS8X.CodeGen" #> - import է անում ArmSoft.AS8X.CodeGen գրադարանը։ Կարելի է import անել միայն այն գրադարնները, որնց համապատասխան assembly-ին reference-ով կպցված է .tt ընդլայնմամբ ֆայլի գտնվելու assembly-ին։
- <#@ output extension=".cs" #> - ցույց է տալիս գեներացվող  ֆայլի ընդլանման տեսակը, այս դեպքում է գեներացվելու է .cs ընդլայնմամբ ֆայլ՝ c# class:

## Տվյալների աղբյուրի նկարագրությունը տեղափոխելու համար անհրաժեշտ քայլեր

Տվյալների աղբյուրի նկարագրությունը պարունակող c# դասը գեներացնելու համար անհրաժեշտ է նշված ընդհանուր քայլերից հետո ավելացնել տվյալների աղբյուրի 4x-ական նկարագրությունը 8x-ականի parse անող մեթոդը կանչը՝ փոխանցելով անհրաժեշտ արգումենտները ու մեթոդի արդյունքը փոխանցել code անունով string տիպի փոփոխականի։

DSParser static դասի Parse մեթոդը ունի հետևյալ շարահյուսությունը՝

```c#
        public static string Parse(string configFilePath, string filename, string dsName, string namespaceName,
                                   string className = "", bool generatePublicConstructor = false, string conditionalCompilationList = "")
```
Լրացման օրինակ՝ 
```c#
<#
    string code = DSParser.Parse(this.Host.ResolvePath("..\\..\\..\\CodeGen.xml"), "SOURCE\\ACCBAL\\ACCBAL.AS", "AccCli", "Bank.General.AccBal.DS","AccountsAndClients");
#>
<#= code #>
```

Parse մեթոդի պարամետրերն են՝

| Անվանում                  | Տեսակ  | Նկարագրություն                                                                                                                                                                                                                     | Լռությամբ արժեք                                      |
|---------------------------|:------:|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| configFilePath            | string | CodeGen.xml-ի ճանապարհը                                                                                                                                                                                                            | Չունի, արժեքը պարտադիր է լրացնել                    |
| filename                  | string | 4x-ական տվյալների աղբյուրը պարունակող .as ընդլայնմամբ ֆայլի ճանապարհը                                                                                                                                                               | Չունի, արժեքը պարտադիր է լրացնել                    |
| dsName                    | string | Տվյալների աղբյուրի ներքին անվանումը                                                                                                                                                                                                | Չունի, արժեքը պարտադիր է լրացնել                    |
| namespaceName             | string | Գեներացվող դասի namespace-ը                                                                                                                                                                                                       | Չունի, արժեքը պարտադիր է լրացնել                    |
| className                 | string | Գեներացվող դասի անվանումը։ Չլրացնելու դեպքում գեներացվող դասի անվանումը համընկնելու է տվյալների աղբյուրի ներքին անվանման հետ՝ dsName։                                                                                                | string.Empty                                        |
| generatePublicConstructor | bool   | Գեներացվող  դասի կոնստրուկտորը լինի public թե private հասանելիությամբ։ Չլրացնելու դեպքում գեներացվում է private հասանելիությամբ կոնստրուկտոր                                                                                        | false                                               |
| conditionalCompilationList| string | Որոշ տվյալների աղբյուրներ ընդհանուր են մի քանի համակարգերի համար և տարբերվում են միայն գտնվելու տեղով՝ namespace-ով։ Որպեսզի նույն դասը 2 տեղ չգրենք, տեղադրում ենք Tfs-ում ընդհանուր հասանելիության թղթապանակում և լինկով միացնում անհրաժեշտ պրոյեկտներում։ Իսկ conditionalCompilationList-ում գրում ենք այն պրոյեկտների անվանումները, որոնց լինկով միացրել ենք դասը։ Պրոյեկտների անունները  անհրաժեշտ է իրարից անջատել ստորակետերով։ | string.Empty                                        |


## Փաստաթղթի նկարագրությունը տեղափոխելու համար անհրաժեշտ քայլեր

4x համակարգում գոյություն ունի փաստաթուղթը նկարագրող մեկ դաս, որը ծառայում է և՛ կլիենտական և՛ սերվիսային նպատակներով:
8x-համակարգում սերվիսային և կլիենտական ֆունկցիոնալությունները առանձնացված են և յուրաքանչյուրի համար դաս է սահմանված։

### Սերվիսային նկարագրության տեղափոխում

Փաստաթղթի սերվիսային նկարագրությունը պարունակող c# դասը գեներացնելու համար անհրաժեշտ է նշված ընդհանուր քայլերից հետո ավելացնել փաստաթղթի  4x-ական նկարագրությունը 8x-ականի parse անող մեթոդը կանչը՝ փոխանցելով անհրաժեշտ արգումենտները ու մեթոդի արդյունքը փոխանցել code անունով string տիպի փոփոխականի։

DocParser static դասի Parse մեթոդը ունի հետևյալ շարահյուսությունը՝
```c#
        public static string Parse(string configFilePath, string filename, string docType, string namespaceName, string className = "",
                                   string conditionalCompilationList = "", DocGeneratorOptions options = null, string parentClass = "",
                                   bool generateFieldAccessor = false, bool uppercaseAll = false)
```
Լրացման օրինակ՝ 
``` c#
<#
string code = DocParser.Parse(configFilePath:this.Host.ResolvePath("..\\..\\..\\..\\..\\Enterprise\\AS-8X\\ArmSoft.AS8X.Enterprise\\CodeGen.xml"),
                              filename:"\\OLAP\\EnterpriseCommon\\OLPGRP.as",
                              docType:"OLPGRP",
                              namespaceName:"Doc.OLAP",
                              conditionalCompilationList:"Enterprise, Wages",
                              generateFieldAccessor:true,
                              className:"AtmIndGrp");
#>
<#= code #>
```

Parse մեթոդի պարամետրերն են՝

| Անվանում                  | Տեսակ             | Նկարագրություն                                                                                                                                                                                                                   | Լռությամբ արժեք                                      |
|---------------------------|:-----------------:|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| configFilePath            | string            | CodeGen.xml ճանապարհը                                                                                                                                                                                                            | Չունի, արժեքը պարտադիր է լրացնել                    |
| filename                  | string            | 4x-կան փաստաթուղթը պարունակող .as ընդլայնմամբ ֆայլի ճանապարհը                                                                                                                                                                    | Չունի, արժեքը պարտադիր է լրացնել                    |
| docType                   | string            | Փաստաթղթի տեսակը                                                                                                                                                                                                                | Չունի, արժեքը պարտադիր է լրացնել                    |
| namespaceName             | string            | Գեներացվող դասի namespace-ը                                                                                                                                                                                                     | Չունի, արժեքը պարտադիր է լրացնել                    |
| className                 | string            | Գեներացվող դասի անվանումը։ Չլրացնելու դեպքում գեներացվող դասի անվանումը համընկնելու է փաստաթղթի տեսակի  անվանման հետ՝ docType                                                                                                    | string.Empty                                        |
| conditionalCompilationList| string            | Որոշ տվյալների աղբյուրներ ընդհանուր են մի քանի համակարգերի համար և տարբերվում են միայն գտնվելու տեղով՝ namespace-ով։ Որպեսզի նույն դասը 2 տեղ չգրենք, տեղադրում ենք Tfs-ում ընդհանուր հասանելիության թղթապանակում և լինկով միացնում անհրաժեշտ պրոյեկտներում։ Իսկ conditionalCompilationList-ում գրում ենք այն պրոյեկտների անվանումները, որոնց լինկով միացրել ենք դասը։ Պրոյեկտների անունները  անհրաժեշտ է իրարից անջատել ստորակետերով։ | string.Empty                                        |
| options                   | DocGeneratorOptions| Այս հատկության միջոցով կարող ենք վերանվանել փաստաթղթի ռեկվիզիտները ու grid-ի սյուների անունները։                                                                                                                                | null                                                |
| parentClass               | string            | Այն դասից որից ժառանգելու է գեներացվող փաստաթուղթը։ Նշված դասը պետք է ժառանգ լինի Document դասից։ Չլրացնելու դեպքում ժառանգելու է Document դասից։                                                                                | string.Empty                                        |
| generateFieldAccessor     | bool              | Ցույց է տալիս թե գեներացվող փաստաթղթի դաշտերը լինեն c#-ի ներդրված տիպերի թե DocumentFieldAccessor<T> տիպի, որտեղ որպես T դրվում է դաշտի համակարգային տիպին համապատասխան c#-ի ներդրված տիպը։                                   | false                                               |
| uppercaseAll              | bool              | Ցույց է տալիս թե գեներացվող դասի բոլոր էլեմենտների(ռեկվիզիտ, մեմո, աղյուսակի սյուն, …) անունները լինեն մեծատառ թե ոչ։ Չլրացնելու դեպքում էլեմենտները անունները ունենում են 4x-ին համարժեք անուններ։                                | false                                               |


—------------------------------------------------------------------------------------------------------------------------

### .as ընդլայմամբ ֆայլի մեջ գտնվող բոլոր փաստաթղթերի սերվիսային նկարագրությունների տեղափոխում

.as ֆայլում գնտվող բոլոր փաստաթղթերի սերվիսային նկարագրությունների  c#-ական դասերը գեներացնելու համար անհրաժեշտ է նշված ընդհանուր քայլերից հետո ավելացնել փաստաթղթերի  4x-ական նկարագրությունները 8x-ականի parse անող մեթոդի կանչը՝ փոխանցելով անհրաժեշտ արգումենտները ու մեթոդի արդյունքը փոխանցել code անունով string տիպի փոփոխականի։

DocParser static դասի ParseAll մեթոդը ունի հետևյալ շարահյուսությունը՝

```c#
        public static string ParseAll(string configFilePath, string filename, string namespaceName,
                                      string conditionalCompilationList = "", Dictionary<string, DocGeneratorOptions> options = null,
                                      bool generateFieldAccessor = false, bool uppercaseAll = false)
```


Լրացման օրինակ՝ 
``` c#
<#    
    string code = DocParser.ParseAll(configFilePath : this.Host.ResolvePath("..\\..\\..\\..\\..\\Enterprise\\AS-8X\\ArmSoft.AS8X.Enterprise\\CodeGen.xml"),
	                                    filename : "\\SYSTEM\\EnterpriseCommon\\Approvals\\ApprStages.as",
		                                namespaceName : "Client.Documents.System.ApprCompoundStage",
                                        conditionalCompilationList:"EnterpriseClient, WagesClient",
		                                className : "ApprCompoundStage");

   
#>
<#= code #>
```

ParseAll մեթոդի պարամետրերն են՝


| Անվանում                  | Տեսակ                                | Նկարագրություն                                                                                                                                                                                                                   | Լռությամբ արժեք                                      |
|---------------------------|:------------------------------------:|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| configFilePath            | string                               | CodeGen.xml ճանապարհը                                                                                                                                                                                                            | Չունի, արժեքը պարտադիր է լրացնել                    |
| filename                  | string                               | 4x-կան փաստաթուղթը պարունակող .as ընդլայնմամբ ֆայլի ճանապարհը                                                                                                                                                                    | Չունի, արժեքը պարտադիր է լրացնել                    |
| namespaceName             | string                               | Գեներացվող դասի namespace-ը                                                                                                                                                                                                     | Չունի, արժեքը պարտադիր է լրացնել                    |
| conditionalCompilationList| string                               | Որոշ փաստաթղթեր ընդհանուր են մի քանի համակարգերի համար և տարբերվում են միայն գտնվելու տեղով՝ namespace-ով։ Որպեսզի նույն դասը 2 տեղ չգրենք, տեղադրում ենք Tfs-ում ընդհանուր հասանելիության թղթապանակում և լինկով միացնում անհրաժեշտ պրոյեկտներում։ Իսկ conditionalCompilationList-ում գրում ենք այն պրոյեկտների անվանումները, որոնց լինկով միացրել ենք դասը։ Պրոյեկտների անունները  անհրաժեշտ է իրարից անջատել ստորակետերով։ | string.Empty                                        |
| options                   | Dictionary<string, DocGeneratorOptions>| Այս հատկության միջոցով կարող ենք վերանվանել փաստաթղթի ռեկվիզիտները ու grid-ի սյուների անունները։                                                                                                                                | null                                                |
| generateFieldAccessor     | bool                                 | Ցույց է տալիս թե գեներացվող փաստաթղթերի դաշտերը լինեն c#-ի ներդրված տիպերի թե DocumentFieldAccessor<T> տիպի, որտեղ որպես T դրվում է դաշտի համակարգային տիպին համապատասխան c#-ի ներդրված տիպը։                                   | false                                               |
| uppercaseAll              | bool                                 | Ցույց է տալիս թե գեներացվող դասերի բոլոր էլեմենտների(ռեկվիզիտ, մեմո, աղյուսակի սյուն, …) անունները լինեն մեծատառ թե ոչ։ Չլրացնելու դեպքում էլեմենտները անունները ունենում են 4x-ին համարժեք անուններ։                                | false                                               |


Ի տարբերություն DocParser դասի Parse մեթոդի, այս մեթոդում չենք կարող նշել գեներացվող դասերի անունները, գեներացվող դասերի ունենալու են փաստաթղթի 4x-ական անունը: Նաև չենք կարող նշել այն դասը, որից ժառանգելու են գեներացվող դասերը, բոլորը ժառանգվելու են Document դասից։

—------------------------------------------------------------------------------------------------------------------------

# Կլիենտական նկարագրության տեղափոխում

Փաստաթղթի կլիենտական նկարագրությունը պարունակող c# դասը գեներացնելու համար անհրաժեշտ է նշված ընդհանուր քայլերից հետո ավելացնել փաստաթղթի 4x-ական նկարագրությունը 8x-ական parse անող մեթոդը կանչը՝ փոխանցելով անհրաժեշտ արգումենտները ու մեթոդի արդյունքը փոխանցել code անունով string տիպի փոփոխականի։

DocParser static դասի ParseClient մեթոդը ունի հետևյալ շարահյուսությունը՝

        public static string ParseClient(string configFilePath, string filename, string docType, string namespaceName, string className = "",
                                         string conditionalCompilationList = "", DocGeneratorOptions options = null, string parentClass = "")


Լրացման օրինակ՝ 
<#    
    string code = DocParser.ParseClient(configFilePath : this.Host.ResolvePath("..\\..\\..\\..\\..\\Enterprise\\AS-8X\\ArmSoft.AS8X.Enterprise\\CodeGen.xml"),
	                                    filename : "\\SYSTEM\\EnterpriseCommon\\Approvals\\ApprStages.as",
		                                docType : "AppStCmp",
		                                namespaceName : "Client.Documents.System.ApprCompoundStage",
                                        conditionalCompilationList:"EnterpriseClient, WagesClient",
		                                className : "ApprCompoundStage");

   
#>
<#= code #>


ParseClient մեթոդի պարամետրերն են՝

| Անվանում                  | Տեսակ             | Նկարագրություն                                                                                                                                                                                                                   | Լռությամբ արժեք                                      |
|---------------------------|:-----------------:|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| configFilePath            | string            | CodeGen.xml ճանապարհը                                                                                                                                                                                                            | Չունի, արժեքը պարտադիր է լրացնել                    |
| filename                  | string            | 4x-կան փաստաթուղթը պարունակող .as ընդլայնմամբ ֆայլի ճանապարհը                                                                                                                                                                    | Չունի, արժեքը պարտադիր է լրացնել                    |
| docType                   | string            | Փաստաթղթի տեսակը                                                                                                                                                                                                                | Չունի, արժեքը պարտադիր է լրացնել                    |
| namespaceName             | string            | Գեներացվող դասի namespace-ը                                                                                                                                                                                                     | Չունի, արժեքը պարտադիր է լրացնել                    |
| className                 | string            | Գեներացվող դասի անվանումը։ Չլրացնելու դեպքում գեներացվող դասի անվանումը համընկնելու է փաստաթղթի տեսակի անվանման հետ՝ docType                                                                                                    | string.Empty                                        |
| conditionalCompilationList| string            | Որոշ փաստաթղթեր ընդհանուր են մի քանի համակարգերի համար և տարբերվում են միայն գտնվելու տեղով՝ namespace-ով։ Որպեսզի նույն դասը 2 տեղ չգրենք, տեղադրում ենք Tfs-ում ընդհանուր հասանելիության թղթապանակում և լինկով միացնում անհրաժեշտ պրոյեկտներում։ Իսկ conditionalCompilationList-ում գրում ենք այն պրոյեկտների անվանումները, որոնց լինկով միացրել ենք դասը։ Պրոյեկտների անունները անհրաժեշտ է իրարից անջատել ստորակետերով։ | string.Empty                                        |
| options                   | DocGeneratorOptions| Այս հատկության միջոցով կարող ենք վերանվանել փաստաթղթի ռեկվիզիտները ու grid-ի սյուների անունները։                                                                                                                                | null                                                |
| parentClass               | string            | Այն դասի անվանումը, որից ժառանգելու է գեներացվող փաստաթուղթը։ Նշված դասը պետք է ժառանգ լինի Document դասից։ Չլրացնելու դեպքում ժառանգելու է Document դասից։                                                                       | string.Empty                                        |

—------------------------------------------------------------------------------------------------------------------------

### .as ընդլայմամբ ֆայլի մեջ գտնվող բոլոր փաստաթղթերի կլիենտական նկարագրությունների տեղափոխում

.as ֆայլում գնտվող բոլոր փաստաթղթերի կլիենտական նկարագրությունների  c#-ական դասերը գեներացնելու համար անհրաժեշտ է նշված քայլերից հետո ավելացնել փաստաթղթի 4x-ական տվյալները 8x-ական parse անող մեթոդը կանչը՝ փոխանցելով անհրաժեշտ արգումենտները ու մեթոդի արդյունքը փոխանցել code անունով string տիպի փոփոխականի։

DocParser static դասի ParseClientAllմեթոդը ունի հետևյալ շարահյուսությունը՝

        public static string ParseClientAll(string configFilePath, string filename, string namespaceName,
                                            string conditionalCompilationList = "", Dictionary<string, DocGeneratorOptions> options = null)




Լրացման օրինակ՝ 
```c#
<#    
    string code = DocParser.ParseClientAll(configFilePath : this.Host.ResolvePath("..\\..\\..\\..\\..\\Enterprise\\AS-8X\\ArmSoft.AS8X.Enterprise\\CodeGen.xml"),
	                                    filename : "\\SYSTEM\\EnterpriseCommon\\Approvals\\ApprStages.as",
		                                namespaceName : "Client.Documents.System.ApprCompoundStage",
                                        conditionalCompilationList:"EnterpriseClient, WagesClient",
		                                className : "ApprCompoundStage");

   
#>
<#= code #>
```

ParseClientAll մեթոդի պարամետրերն են՝

| Անվանում                  | Տեսակ                                | Նկարագրություն                                                                                                                                                                                                                   | Լռությամբ արժեք                                      |
|---------------------------|:------------------------------------:|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| configFilePath            | string                               | CodeGen.xml ճանապարհը                                                                                                                                                                                                            | Չունի, արժեքը պարտադիր է լրացնել                    |
| filename                  | string                               | 4x-կան փաստաթուղթը պարունակող .as ընդլայնմամբ ֆայլի ճանապարհը                                                                                                                                                                    | Չունի, արժեքը պարտադիր է լրացնել                    |
| namespaceName             | string                               | Գեներացվող դասի namespace-ը                                                                                                                                                                                                     | Չունի, արժեքը պարտադիր է լրացնել                    |
| conditionalCompilationList| string                               | Որոշ փաստաթղթեր ընդհանուր են մի քանի համակարգերի համար և տարբերվում են միայն գտնվելու տեղով՝ namespace-ով։ Որպեսզի նույն դասը 2 տեղ չգրենք, տեղադրում ենք Tfs-ում ընդհանուր հասանելիության թղթապանակում և լինկով միացնում անհրաժեշտ պրոյեկտներում։ Իսկ conditionalCompilationList-ում գրում ենք այն պրոյեկտների անվանումները, որոնց լինկով միացրել ենք դասը։ Պրոյեկտների անունները անհրաժեշտ է իրարից անջատել ստորակետերով։ | string.Empty                                        |
| options                   | Dictionary<string, DocGeneratorOptions>| Այս հատկության միջոցով կարող ենք վերանվանել փաստաթղթի ռեկվիզիտները ու grid-ի սյուների անունները։                                                                                                                                | null                                                |


